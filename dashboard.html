<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Re Bottle for Point Machine</title>
  <meta name="description" content="Dashboard สำหรับติดตามจำนวนขวดแบบ Real-time" />
  
  <!-- AOS Animation Library -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
  <style>
    :root{
      --bg: #0b1020;          /* พื้นหลังเข้ม */
      --card: #121833;        /* การ์ดเข้ม */
      --text: #e7eaf6;        /* ข้อความหลัก */
      --muted: #aab1d6;       /* ข้อความรอง */
      --brand: #7c5cff;       /* สีหลัก */
      --brand-2: #22d3ee;     /* สีรอง */
      --ok: #34d399;          /* สำเร็จ */
      --warn: #fbbf24;        /* เตือน */
      --error: #ef4444;       /* ผิดพลาด */
      --radius-xl: 20px;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --shadow-soft: 0 6px 18px rgba(0,0,0,.22);
    }

    /* รีเซ็ตเล็กน้อย */
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans Thai", "Noto Sans", "Liberation Sans", sans-serif;
      color:var(--text); 
      background: 
        radial-gradient(1200px 600px at 10% -10%, rgba(124,92,255,.35), transparent 55%), 
        radial-gradient(1200px 800px at 110% 0%, rgba(34,211,238,.25), transparent 55%), 
        var(--bg);
      line-height:1.6; letter-spacing:.2px;
    }
    
    /* Dashboard Watermark overlay */
    body::before {
      content: '';
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 350px;
      height: 350px;
      background: url('ขวดโรงเรียน.jpg') no-repeat center center;
      background-size: contain;
      opacity: 0.02;
      z-index: 0;
      pointer-events: none;
    }

    .container{ width:min(1200px, 95%); margin-inline:auto; }

    /* Navbar */
    .nav{ position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(8px); background:rgba(11,16,32,.8); border-bottom:1px solid rgba(255,255,255,.05); }
    .nav-inner{ display:flex; align-items:center; justify-content:space-between; padding:14px 0; }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text); font-weight:700; }
    .logo{ width:36px; height:36px; border-radius:10px; background: conic-gradient(from 210deg at 50% 50%, var(--brand), var(--brand-2), var(--brand)); box-shadow: var(--shadow-soft); }
    .logo-img{ width:40px; height:40px; border-radius:10px; object-fit:cover; box-shadow: var(--shadow-soft); }
    .nav-actions{ display:flex; align-items:center; gap:12px; }
    .user-info{ display:flex; align-items:center; gap:8px; color:var(--muted); }
    .avatar{ width:32px; height:32px; border-radius:50%; background:linear-gradient(135deg, var(--brand), var(--brand-2)); }
    .btn-logout{ appearance:none; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.05); color:var(--text); padding:8px 12px; border-radius:8px; cursor:pointer; font-size:14px; transition:.2s ease; }
    .btn-logout:hover{ background:var(--error); border-color:var(--error); }

    /* Header */
    .header{ padding:32px 0 24px; }
    .header h1{ margin:0; font-size: clamp(28px, 4vw, 36px); }
    .header p{ color:var(--muted); margin:8px 0 0; }

    /* Status indicator */
    .status{ display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; font-size:14px; margin-top:12px; }
    .status.online{ background:rgba(52,211,153,.1); border:1px solid rgba(52,211,153,.3); color:var(--ok); }
    .status.offline{ background:rgba(239,68,68,.1); border:1px solid rgba(239,68,68,.3); color:var(--error); }
    .pulse-dot{ width:8px; height:8px; border-radius:50%; }
    .pulse-dot.online{ background:var(--ok); animation: pulse 2s infinite; }
    .pulse-dot.offline{ background:var(--error); }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Main grid */
    .dashboard-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:24px; margin-bottom:32px; }
    
    /* Cards */
    .card{ background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); border:1px solid rgba(255,255,255,.12); border-radius: var(--radius-xl); padding:24px; box-shadow: var(--shadow-soft); }
    .card h3{ margin:0 0 16px; font-size:18px; color:var(--muted); display:flex; align-items:center; gap:8px; }

    /* Counter card */
    .counter-main{ text-align:center; }
    .bottle-count{ font-size: clamp(48px, 8vw, 72px); font-weight:800; margin:16px 0; background: linear-gradient(135deg, var(--brand), var(--brand-2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .bottle-icon{ font-size:48px; margin-bottom:12px; }
    .last-updated{ color:var(--muted); font-size:14px; margin-top:8px; }

    /* Stats grid */
    .stats-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    .stat-item{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:16px; text-align:center; }
    .stat-number{ font-size:24px; font-weight:700; margin-bottom:4px; }
    .stat-label{ font-size:12px; color:var(--muted); }

    /* History table */
    .history-table{ width:100%; border-collapse:collapse; }
    .history-table th{ text-align:left; padding:12px 8px; border-bottom:1px solid rgba(255,255,255,.1); color:var(--muted); font-size:14px; }
    .history-table td{ padding:12px 8px; border-bottom:1px solid rgba(255,255,255,.05); }
    .time-badge{ background:rgba(255,255,255,.06); padding:4px 8px; border-radius:6px; font-size:12px; }

    /* Progress bar */
    .progress-container{ margin:16px 0; }
    .progress-label{ display:flex; justify-content:space-between; margin-bottom:8px; font-size:14px; }
    .progress-bar{ height:8px; background:rgba(255,255,255,.1); border-radius:4px; overflow:hidden; }
    .progress-fill{ height:100%; background:linear-gradient(90deg, var(--brand), var(--brand-2)); transition: width 0.3s ease; border-radius:4px; }

    /* Alert */
    .alert{ padding:16px; border-radius:12px; margin-bottom:24px; display:flex; align-items:center; gap:12px; }
    .alert.success{ background:rgba(52,211,153,.1); border:1px solid rgba(52,211,153,.3); color:var(--ok); }
    .alert.warning{ background:rgba(251,191,36,.1); border:1px solid rgba(251,191,36,.3); color:var(--warn); }

    /* Responsive */
    @media (max-width: 800px){
      .dashboard-grid{ grid-template-columns: 1fr; }
      .stats-grid{ grid-template-columns: 1fr; }
    }

    /* Loading animation */
    .loading{ display:inline-block; width:20px; height:20px; border:2px solid rgba(255,255,255,.1); border-radius:50%; border-top-color:var(--brand); animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* Enhanced bottle image */
    .bottle-img {
      max-width: 180px;
      margin-bottom: 15px;
      transition: transform 0.5s ease;
    }
    .bottle-img:hover {
      transform: scale(1.05) rotate(3deg);
    }
    
    /* Enhanced card styles */
    .card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(255,255,255,0.05);
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.4);
    }
    
    /* Enhanced stat items */
    .stat-item {
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    .stat-item:hover {
      transform: translateY(-3px);
    }
    .stat-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(124,92,255,0.2), transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .stat-item:hover::before {
      opacity: 1;
    }

  </style>
</head>
<body>
  <!-- NAVBAR -->
  <nav class="nav" data-aos="fade-down" data-aos-duration="800">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <img src="logo web ขวด.jpg" alt="Re Bottle for Point Machine Logo" class="logo-img" style="border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.3s ease;" href="index.html">
        <span>Re Bottle for Point Machine</span>
      </a>
      <div class="nav-actions">
        <div class="user-info">
          <div class="avatar" aria-hidden="true"></div>
          <span id="userName">Loading...</span>
          <button class="btn-logout" style="background:var(--brand-2); color:#222; border:none;" onclick="toggleTheme()">Bright</button>
        </div>
        
        <button class="btn-logout" onclick="logout()">ออกจากระบบ</button>
      </div>
    </div>
  </nav>

  <!-- HEADER -->
  <header class="header">
    <div class="container" data-aos="fade-up" data-aos-duration="1000" data-aos-delay="200">
      <h1>Re Bottle for Point Machine - ระบบนับขวด</h1>
      <p>ติดตามจำนวนขวดที่นับได้แบบ Real-time และคำนวณชั่วโมงจิตอาสา</p>
      <div class="status" id="connectionStatus">
        <div class="pulse-dot offline"></div>
        <span>กำลังเชื่อมต่อ...</span>
      </div>
    </div>
  </header>

  <!-- MAIN DASHBOARD -->
  <main class="container">
    
    <!-- Alert for first time users -->
    <div class="alert success" id="welcomeAlert" style="display:none;">
      <span>🎉</span>
      <div>
        <strong>ยินดีต้อนรับ!</strong>
        <div>ระบบพร้อมทำงาน เครื่องนับขวดจะอัพเดทข้อมูลแบบ Real-time</div>
        <div style="margin-top:8px; font-size:13px; color:var(--muted);">
          💡 <strong>วิธีคำนวณจิตอาสา:</strong> ทุก 30 ขวด = 1 ชั่วโมงจิตอาสา
        </div>
        <button class="btn-logout" style="background:var(--brand-2); color:#222; border:none; margin-top:10px;" onclick="toggleTheme()">เปลี่ยนธีม Bright</button>
        <script>
            // Improved Bright/Dark Theme Toggle with Animation & More Colors
            function toggleTheme() {
            const root = document.documentElement;
            const isDark = root.style.getPropertyValue('--bg') === '#0b1020' || !root.style.getPropertyValue('--bg');
            if (isDark) {
              // Bright mode: more playful gradients, soft shadows, animated transition
              root.style.setProperty('--bg', '#f8fafc');
              root.style.setProperty('--card', '#fff');
              root.style.setProperty('--text', '#232946');
              root.style.setProperty('--muted', '#6b7280');
              root.style.setProperty('--brand', '#7c5cff');
              root.style.setProperty('--brand-2', '#22d3ee');
              root.style.setProperty('--ok', '#10b981');
              root.style.setProperty('--warn', '#f59e42');
              root.style.setProperty('--error', '#ef4444');
              root.style.setProperty('--shadow', '0 8px 32px rgba(124,92,255,.10)');
              root.style.setProperty('--shadow-soft', '0 4px 16px rgba(34,211,238,.10)');
              root.style.setProperty('--radius-xl', '24px');
              root.style.setProperty('--radius', '16px');
              document.body.style.transition = "background 0.7s cubic-bezier(.4,2,.6,1)";
              document.body.style.background = 
              "radial-gradient(1200px 600px at 10% -10%, rgba(124,92,255,.12), transparent 55%)," +
              "radial-gradient(1200px 800px at 110% 0%, rgba(34,211,238,.10), transparent 55%)," +
              "linear-gradient(120deg, #f8fafc 60%, #e0e7ff 100%)";
              // Add a subtle confetti animation for fun
              if (!document.getElementById('confetti-canvas')) {
              const canvas = document.createElement('canvas');
              canvas.id = 'confetti-canvas';
              canvas.style.position = 'fixed';
              canvas.style.top = 0;
              canvas.style.left = 0;
              canvas.style.width = '100vw';
              canvas.style.height = '100vh';
              canvas.style.pointerEvents = 'none';
              canvas.style.zIndex = 9999;
              document.body.appendChild(canvas);
              launchConfetti(canvas);
              setTimeout(() => {
                if (canvas.parentNode) canvas.parentNode.removeChild(canvas);
              }, 1200);
              }
            } else {
              // Back to dark mode
              root.style.setProperty('--bg', '#0b1020');
              root.style.setProperty('--card', '#121833');
              root.style.setProperty('--text', '#e7eaf6');
              root.style.setProperty('--muted', '#aab1d6');
              root.style.setProperty('--brand', '#7c5cff');
              root.style.setProperty('--brand-2', '#22d3ee');
              root.style.setProperty('--ok', '#34d399');
              root.style.setProperty('--warn', '#fbbf24');
              root.style.setProperty('--error', '#ef4444');
              root.style.setProperty('--shadow', '0 10px 30px rgba(0,0,0,.35)');
              root.style.setProperty('--shadow-soft', '0 6px 18px rgba(0,0,0,.22)');
              root.style.setProperty('--radius-xl', '20px');
              root.style.setProperty('--radius', '14px');
              document.body.style.transition = "background 0.7s cubic-bezier(.4,2,.6,1)";
              document.body.style.background = "";
            }
            }

            // Simple confetti animation for bright mode
            function launchConfetti(canvas) {
            const ctx = canvas.getContext('2d');
            const W = window.innerWidth, H = window.innerHeight;
            canvas.width = W;
            canvas.height = H;
            const colors = ['#7c5cff', '#22d3ee', '#f59e42', '#10b981', '#ef4444', '#fff'];
            const confetti = Array.from({length: 32}, () => ({
              x: Math.random() * W,
              y: Math.random() * -H,
              r: 6 + Math.random() * 8,
              d: 8 + Math.random() * 12,
              color: colors[Math.floor(Math.random() * colors.length)],
              tilt: Math.random() * 10 - 5,
              tiltAngle: 0,
              tiltAngleIncremental: (Math.random() * 0.07) + 0.05
            }));
            let frame = 0;
            function draw() {
              ctx.clearRect(0, 0, W, H);
              confetti.forEach(c => {
              ctx.beginPath();
              ctx.ellipse(c.x, c.y, c.r, c.r/2, c.tilt, 0, 2 * Math.PI);
              ctx.fillStyle = c.color;
              ctx.globalAlpha = 0.85;
              ctx.fill();
              });
            }
            function update() {
              confetti.forEach(c => {
              c.y += Math.cos(frame/10 + c.d) + 2 + c.r/6;
              c.x += Math.sin(frame/15) * 2;
              c.tiltAngle += c.tiltAngleIncremental;
              c.tilt = Math.sin(c.tiltAngle) * 8;
              if (c.y > H + 20) {
                c.y = -10;
                c.x = Math.random() * W;
              }
              });
            }
            function animate() {
              frame++;
              update();
              draw();
              if (frame < 60) requestAnimationFrame(animate);
            }
            animate();
            }
        </script>
      </div>
    </div>

    <div class="dashboard-grid">
      
      <!-- MAIN COUNTER -->
      <div class="card counter-main" data-aos="zoom-in" data-aos-duration="1200" data-aos-delay="400">
        <img src="ขวดโรงเรียน.jpg" alt="ขวดโรงเรียน" class="bottle-img" style="border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.15); transition: transform 0.3s ease;">
        <h3>จำนวนขวดทั้งหมด</h3>
        <div class="bottle-count" id="totalBottles">
          <span class="loading"></span>
        </div>
        <div class="last-updated" id="lastUpdated">กำลังโหลด...</div>
        
        <div class="progress-container">
          <div class="progress-label">
            <span>เป้าหมายวันนี้</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <!-- STATISTICS -->
      <div class="card" data-aos="fade-left" data-aos-duration="1000" data-aos-delay="600">
        <h3>📊 สถิติและจิตอาสา</h3>
        <div class="stats-grid">
          <div class="stat-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="800">
            <div class="stat-number" id="todayCount">0</div>
            <div class="stat-label">ขวดวันนี้</div>
          </div>
          <div class="stat-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="900">
            <div class="stat-number" id="volunteerHours">0</div>
            <div class="stat-label">ชม.จิตอาสา</div>
          </div>
          <div class="stat-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="1000">
            <div class="stat-number" id="totalPoints">0</div>
            <div class="stat-label">คะแนนรวม</div>
          </div>
          <div class="stat-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="1100">
            <div class="stat-number" id="weeklyCount">0</div>
            <div class="stat-label">ขวดสัปดาห์นี้</div>
          </div>
        </div>
        
        <!-- Volunteer Hours Info -->
        <div style="margin-top:16px; padding:12px; background:rgba(124,92,255,.1); border:1px solid rgba(124,92,255,.3); border-radius:8px; font-size:13px; text-align:center;">
          <strong>💡 วิธีคำนวณ:</strong> ทุก 30 ขวด = 1 ชั่วโมงจิตอาสา
        </div>
      </div>
    </div>

    <!-- RECENT ACTIVITY -->
    <div class="card" data-aos="fade-up" data-aos-duration="1200" data-aos-delay="800">
      <h3>🔍 กิจกรรมล่าสุด</h3>
      <table class="history-table">
        <thead>
          <tr>
            <th>เวลา</th>
            <th>จำนวน</th>
            <th>คะแนน</th>
            <th>สถานะ</th>
          </tr>
        </thead>
        <tbody id="historyTable">
          <tr>
            <td colspan="4" style="text-align:center; color:var(--muted);">
              <div class="loading" style="margin:20px auto;"></div>
              กำลังโหลดข้อมูล...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getDatabase, ref, onValue, set, push, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAmw1lDRZIxYKDblO8nhS3SR5aTVCVPJbg",
      authDomain: "takultoujink.firebaseapp.com",
      projectId: "takultoujink",
      storageBucket: "takultoujink.firebasestorage.app",
      messagingSenderId: "865462073491",
      appId: "1:865462073491:web:5985dfd8a0e91b71fa3566",
      measurementId: "G-ZVXD02VSWF",
      databaseURL: "https://takultoujink-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    let currentUser = null;
    let bottleData = {
      total: 0,
      today: 0,
      weekly: 0,
      points: 0,
      history: []
    };

    // Check authentication
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        document.getElementById('userName').textContent = user.displayName || user.email;
        initDashboard();
        showWelcomeAlert();
      } else {
        window.location.href = 'login.html';
      }
    });

    // Initialize dashboard
    function initDashboard() {
      const userId = currentUser.uid;
      
      // Listen for real-time updates
      const bottleRef = ref(database, `bottles/${userId}`);
      onValue(bottleRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          updateDashboard(data);
          updateConnectionStatus(true);
        } else {
          // Initialize user data if doesn't exist
          initializeUserData();
        }
      });

      // Listen for live counter updates
      const liveCountRef = ref(database, `live_count/${userId}`);
      onValue(liveCountRef, (snapshot) => {
        const count = snapshot.val();
        if (count !== null && count !== bottleData.total) {
          // New bottle detected!
          const newBottle = count - bottleData.total;
          if (newBottle > 0) {
            animateCounterUpdate(count);
            addToHistory(newBottle);
          }
        }
      });
    }

    // Initialize user data
    function initializeUserData() {
      const userId = currentUser.uid;
      const initialData = {
        total: 0,
        today: 0,
        weekly: 0,
        points: 0,
        lastUpdated: serverTimestamp(),
        history: {}
      };
      
      set(ref(database, `bottles/${userId}`), initialData);
    }

    // Update dashboard with new data
    function updateDashboard(data) {
      bottleData = data;
      
      // Update main counter
      document.getElementById('totalBottles').textContent = data.total || 0;
      
      // Update stats
      document.getElementById('todayCount').textContent = data.today || 0;
      document.getElementById('totalPoints').textContent = data.points || 0;
      document.getElementById('weeklyCount').textContent = data.weekly || 0;
      
      // Calculate volunteer hours (30 bottles = 1 hour)
      const volunteerHours = Math.floor((data.total || 0) / 30);
      document.getElementById('volunteerHours').textContent = volunteerHours;
      
      // Update progress bar (goal: 100 bottles per day)
      const dailyGoal = 100;
      const progressPercent = Math.min((data.today || 0) / dailyGoal * 100, 100);
      document.getElementById('progressPercent').textContent = Math.round(progressPercent) + '%';
      document.getElementById('progressFill').style.width = progressPercent + '%';
      
      // Update last updated time
      if (data.lastUpdated) {
        const lastUpdate = new Date(data.lastUpdated);
        document.getElementById('lastUpdated').textContent = 
          `อัพเดทล่าสุด: ${lastUpdate.toLocaleString('th-TH')}`;
      }
      
      // Update history table
      updateHistoryTable(data.history);
    }

    // Animate counter update
    function animateCounterUpdate(newCount) {
      const counter = document.getElementById('totalBottles');
      counter.style.transform = 'scale(1.1)';
      counter.style.color = 'var(--ok)';
      
      setTimeout(() => {
        counter.style.transform = 'scale(1)';
        counter.style.color = '';
      }, 300);
    }

    // Add new bottle to history
    function addToHistory(count) {
      const userId = currentUser.uid;
      const historyRef = ref(database, `bottles/${userId}/history`);
      
      const newEntry = {
        timestamp: serverTimestamp(),
        count: count,
        points: count * 1, // 1 point per bottle
      };
      
      push(historyRef, newEntry);
    }

    // Update history table
    function updateHistoryTable(history) {
      const tbody = document.getElementById('historyTable');
      
      if (!history || Object.keys(history).length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" style="text-align:center; color:var(--muted);">
              ยังไม่มีข้อมูล
            </td>
          </tr>
        `;
        return;
      }
      
      // Convert to array and sort by timestamp (newest first)
      const historyArray = Object.entries(history)
        .map(([key, value]) => ({...value, id: key}))
        .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0))
        .slice(0, 10); // Show only last 10 entries
      
      tbody.innerHTML = historyArray.map(entry => {
        const time = entry.timestamp ? 
          new Date(entry.timestamp).toLocaleString('th-TH', {
            hour: '2-digit',
            minute: '2-digit',
            day: '2-digit',
            month: '2-digit'
          }) : 'ไม่ทราบ';
        
        return `
          <tr>
            <td><span class="time-badge">${time}</span></td>
            <td>+${entry.count || 1} ขวด</td>
            <td>+${entry.points || 1} คะแนน</td>
            <td style="color:var(--ok);">✓ บันทึกแล้ว</td>
          </tr>
        `;
      }).join('');
    }

    // Update connection status
    function updateConnectionStatus(isOnline) {
      const status = document.getElementById('connectionStatus');
      const dot = status.querySelector('.pulse-dot');
      const text = status.querySelector('span');
      
      if (isOnline) {
        status.className = 'status online';
        dot.className = 'pulse-dot online';
        text.textContent = 'เชื่อมต่อแล้ว';
      } else {
        status.className = 'status offline';
        dot.className = 'pulse-dot offline';
        text.textContent = 'ออฟไลน์';
      }
    }

    // Show welcome alert
    function showWelcomeAlert() {
      const alert = document.getElementById('welcomeAlert');
      alert.style.display = 'flex';
      
      setTimeout(() => {
        alert.style.display = 'none';
      }, 8000); // Show longer to read volunteer info
    }

    // Logout function
    window.logout = async function() {
      try {
        await signOut(auth);
        window.location.href = 'login.html';
      } catch (error) {
        console.error('Logout error:', error);
      }
    };

    // Simulate real-time bottle counting (for testing)
    // Remove this in production when connecting to actual hardware
    function simulateBottleCount() {
      if (!currentUser) return;
      
      setInterval(() => {
        const userId = currentUser.uid;
        const newBottles = Math.floor(Math.random() * 3); // Add 0-2 bottles randomly
        const currentCount = bottleData.total + newBottles;
        
        if (newBottles > 0) {
          // Update live count
          set(ref(database, `live_count/${userId}`), currentCount);
          
          // Update main bottle data
          const updates = {
            total: currentCount,
            today: (bottleData.today || 0) + newBottles,
            weekly: (bottleData.weekly || 0) + newBottles,
            points: (bottleData.points || 0) + newBottles,
            lastUpdated: serverTimestamp()
          };
          
          set(ref(database, `bottles/${userId}`), {
            ...bottleData,
            ...updates
          });
        }
      }, 12000); // Update every 12 seconds for demo
    }

    // Start simulation for demo (remove in production)
    setTimeout(simulateBottleCount, 5000);
  </script>
  
  <!-- AOS Animation Library Script -->
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    // Initialize AOS
    AOS.init({
      duration: 1000,
      easing: 'ease-in-out',
      once: true,
      mirror: false
    });
  </script>
</body>
</html>